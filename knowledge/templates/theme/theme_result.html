{% extends "public_nav.html" %}
{% block title %}<title>知识图谱 - 专题查看</title>{% endblock %}
{% block my_css %}
<!--<link rel="stylesheet" href="/static/css/fishBone.css" />-->
<link rel="stylesheet" href="/static/css/theme_result.css">
<style>
    .table>thead:first-child>tr:first-child>th {
        width: 1%;
    }
    .fishBone {
        position: relative;
        margin-top: 20px;
    }
    .fishBone .fish_box {
        width:540px;
        margin: 0 auto;
        transition: all linear 0.7s;
    }
    .fishBone .fish_item {
        position: relative;
        left: 10px;
        width:170px;
        overflow: hidden;
        margin-right: 10px;
        float: left;
        padding: 12px;
    }
    .fishBone .fish_item li {
        padding: 5px;
    }
    .fishBone .fish_item .weibo {
        width:170px;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }
    .fishBone .fish_item .line-point {
        position: absolute;
        left: 4px;
        bottom:0;
        display: block;
        height: 18px;
        width: 18px;
        background: url(/static/images/line-point.png) no-repeat 0 0;
    }
    .fishBone .fish_item .top .line-point {
        top:0;
    }
    .fishBone .next,.fishBone .prev {
        position: absolute;
        top: 110px;
        display: inline-block;
        width: 20px;
        height: 40px;
        cursor: pointer;
        z-index: 5;
    }
    .fishBone .prev {
        left: 0;
        background: url(/static/images/arrow.png) no-repeat -1px 13px;
    }
    .fishBone .next {
        right: 0;
        background: url(/static/images/arrow.png) no-repeat -19px 13px;
    }
    .fishBone .prev:hover,.fishBone .next:hover{
        background-position-y: -28px;
    }
    .fishBone .line {
        position: absolute;
        top: 130px;
        height: 1px;
        width: 100%;
        border-bottom: 2px dashed #7E899D;
    }
</style>
{% endblock %}

<!-------主要内容------->
{% block main %}
<div id="container">
    <div id="content_left">
        <div class="basic" style="padding-bottom:1%">
            <div class="basic-1">
                <h1 class="user_name" style="font-weight:900;display:inline-block;"></h1>
                <div class="map_area">
                    <dl id="map" style="right:11.3%;">
                        <dt><img src="/static/images/earth.png"></dt>
                        <dd>地图链接</dd>
                    </dl>
                    <dl id="chart" style="right:0.21%">
                        <dt><img src="/static/images/go_line.png" alt=""></dt>
                        <dd>图谱链接</dd>
                    </dl>
                </div>
            </div>
            <div class="basic-2">
                <div class="information">
                    <p class="in_one">
                        <span><b>包含事件数量:</b></span> <span class="nums crude"></span>
                        <span><b>创建时间:</b></span><span class="time crude" style="width: 140px;"></span>
                    </p>
                    <p class="in_two">
                        <span><b>自动标签：</b></span>
                        <span class="tag_2 crude"></span>
                        <a class="more_2">更多</a>
                    </p>
                    <p class="in_three">
                        <span><b>业务标签：</b></span>
                        <span class="tag_3 crude"></span>
                        <a class="more_3">更多</a>
                    </p>
                    <p class="in_four">
                        <span><b>创建人：</b></span> <span class="name crude"></span>
                        <a href="###" id="simlar">相似专题计算</a>
                    </p>
                </div>
            </div>
        </div>
        <div class="include">
            <h3 style="color: white;font-weight: 900">包含事件</h3>
            <div id="things" style="width: 100%;"></div>
        </div>
        <div class="space_analysis">
            <h3 style="color: white;font-weight: 900">时空分析</h3>
            <div class="time">
                <span style="width:8px;height:20px;background-color:#00b7ee;position: relative;top: 3px;"></span>
                <span>时间分析</span>
                <div class="fishBone" style="width: 630px;height:280px;overflow: hidden;">
                    <!--<div class="fish_item">-->
                        <!--<ul class="top">-->
                            <!--<li style="border-left: 1px solid rgb(248, 151, 130);">事件ID：te-lang-pu-1480176000</li>-->
                            <!--<li style="border-left: 1px solid rgb(248, 151, 130);">微博内容：里在靠电n/RfOR78O</li>-->
                            <!--<li style="border-left: 1px solid rgb(248, 151, 130);">时间：2016-11-27 08:10:44</li>-->
                            <!--<li class="line-last line-point" style="background-position: 0px 0px;"></li>-->
                        <!--</ul>-->
                    <!--</div>-->
                    <!--<div class="fish_item">-->
                        <!--<ul class="bottom">-->
                            <!--<li style="border-left: 1px solid rgb(26, 132, 206);">事件ID：lu-han-1480176000</li>-->
                            <!--<li style="border-left: 1px solid rgb(26, 132, 206);">微博内容：！定由]</li>-->
                            <!--<li style="border-left: 1px solid rgb(26, 132, 206);">时间：2016-11-25 20:37:49</li>-->
                            <!--<li class="line-last line-point" style="background-position: 0px -20px;"></li>-->
                        <!--</ul>-->
                    <!--</div>-->
                    <a class="prev"></a>
                    <a class="next"></a>
                    <div class="line"></div>
                    <div class="fish_box"></div>
                </div>
            </div>
            <div class="place">
                <span style="width:8px;height:20px;background-color:#00b7ee;position: relative;top: 3px;"></span>
                <span>地域分析</span>
                <div id="area" style="width: 100%;height: 300px;"></div>
            </div>
        </div>
        <div class="network_analysis">
            <h3 style="color: white;font-weight: 900;padding:0; ">网络分析</h3>
            <div class="net_detail">
                <div class="detail-1">
                    <img src="/static/images/structure.png"/> <span>内部关联事件数：</span><span class="det-1"></span>
                    <img src="/static/images/top.png"/> <span>内部关联度：</span><span class="det-2"></span>
                    <img src="/static/images/note.png"/> <span>该专题内部事件</span><span class="det-3"></span>
                </div>
                <div id="network_list" style="width: 100%"></div>
            </div>
        </div>
        <div class="topic_analysis">
            <h3 style="color: white;font-weight: 900">话题分析</h3>
            <div style="width: 100%;text-align: center;margin-top: 2%;">
                <div class="topic_left">
                    <span style="width:8px;height:20px;background-color:#00b7ee;position: relative;top: 3px;"></span>
                    <span>事件自动标签</span>
                    <div id="tag_left"></div>
                </div>
                <div class="topic_right">
                    <span style="width:8px;height:20px;background-color:#00b7ee;position: relative;top: 3px;"></span>
                    <span>事件微话题</span>
                    <div id="tag_right"></div>
                </div>
            </div>

        </div>
        <div class="character_analysis">
            <h3 style="color: white;font-weight: 900">人物分析</h3>
            <div class="character-1">
                <span style="width:8px;height:20px;background-color:#00b7ee;position: relative;top: 3px;"></span>
                <span>人物排名</span>
                <div id="ranking" style="width: 100%;"></div>
            </div>
            <div class="character-2" style="width: 100%;text-align: center;margin-top: 30px;">
                <div class="character_left" style="float: left;">
                    <span style="width:8px;height:20px;background-color:#00b7ee;position: relative;top: 3px;"></span>
                    <span>人物自动标签</span>
                    <div id="label_left"></div>
                </div>
                <div class="character_right" style="float: left;">
                    <span style="width:8px;height:20px;background-color:#00b7ee;position: relative;top: 3px;"></span>
                    <span>人物业务标签</span>
                    <div id="label_right"></div>
                </div>
            </div>
        </div>
    </div>

    <div id="content_right">
        <div class="link_user">
            <h3>关联人物</h3>
            <div class="users" style="text-align: center;margin: 20px 0;">

            </div>
            <button class="user_more" type="button" data-toggle="modal">+查看详情</button>
        </div>
        <div class="link_event" style="margin: 10px 0;">
            <h3>关联事件</h3>
            <div class="events" style="text-align: center;margin:20px 0;">

            </div>
            <button class="event_more" type="button" data-toggle="modal">+查看详情</button>
        </div>
        <div class="link_agency" style="margin: 10px 0;">
            <h3>关联机构</h3>
            <div class="agencys" style="text-align: center;margin:20px 0;">

            </div>
            <button class="agency_more" type="button" data-toggle="modal">+查看详情</button>
        </div>
        <div class="link_knowledge" style="margin: 10px 0;">
            <h3>关联知识</h3>
            <div class="knowledge" style="text-align: center;margin:20px 0;">

            </div>
            <button class="knowledge_more" type="button" data-toggle="modal">+查看更多</button>
        </div>
        <div class="link_resources" style="margin: 10px 0;">
            <h3>关联资源</h3>
            <div class="resources" style="text-align: center;margin:20px 0;">

            </div>
            <button class="resources_more" type="button" data-toggle="modal">+查看更多</button>
        </div>

    </div>

</div>
<!--关联-->

<div class="modal fade" id="link" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title tit_h4" id="myModalLabel"></h4>
            </div>
            <div class="modal-body" id="link_content">

            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                <button type="button" class="btn btn-primary" data-dismiss="modal">确定</button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="more" tabindex="-1" role="dialog" aria-labelledby="myLabel">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title tit_h4" id="myLabel"></h4>
            </div>
            <div class="modal-body" id="more_content">

            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                <button type="button" class="btn btn-primary" data-dismiss="modal">确定</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

<!------JS-------->
{% block my_js %}
<script>
    var theme_name='{{theme_name}}';
    var submit_user=$('#name').text();
    $('.basic-2 .in_four .name').text(submit_user);
    var basic_url='/theme/theme_analysis_basic/?theme_name='+theme_name+'&submit_user='+submit_user;
    $.ajax({
        url: basic_url,
        type: 'GET',
        dataType: 'json',
        async: true,
        success:basic
    });
    var _id,key,tag;
    function basic(data) {
        var data=eval(data);
        _id=data[0][0];
        $('#container #content_left .basic-1 .user_name').text(data[0][1]);
        $('#container #content_left .basic .basic-2 .nums').text(data[0][2]);
        $('#container #content_left .basic .basic-2 .time').text(data[0][5]);
        if (data[0][3].length==0){
            $('#container #content_left .basic .basic-2 .information .tag_2').text('暂无数据');
        }else {
            key=data[0][3].join(',');
            $('#container #content_left .basic .basic-2 .information .tag_2').text(key);
        };

        $('.more_2').on('click',function () {
            $('#more h4').empty().text('自动标签');
            $('#more #more_content').empty().append(key);
            $('#more').modal('show');
        });


        if (data[0][4].length==0){
            $('#container #content_left .basic .basic-2 .information .tag_3').text('暂无数据');
        }else {
            tag=data[0][4][0];
            $('#container #content_left .basic .basic-2 .information .tag_3').text(tag);
        };

        $('.more_3').on('click',function () {
            $('#more h4').empty().text('业务标签');
            $('#more #more_content').empty().append(tag);
            $('#more').modal('show');
        });

        //=======
        $('#chart').on('click',function () {
            window.open('/index/graph/?user_id='+data[0][0]+'&node_type=topic');
        });
        $('#map').on('click',function () {
            window.open('/index/map/?user_id='+data[0][0]+'&node_type=topic');
        });
    };
    $('#simlar').on('click',function () {
        var time=Date.parse(new Date());
        var creat_url='/relation/compute_sim/?submit_user='+submit_user+'&submit_ts='+time+
                '&node_name='+theme_name+'&node_id='+_id+'&node_type=SpecialEvent';
        $.ajax({
            url: creat_url,
            type: 'GET',
            dataType: 'json',
            async: true,
            success:function (data) {
                if (data=='yes'){
                    alert('创建成功。');
                }else {
                    alert('创建失败。');
                }
            }
        });
    });

</script>
<!--<script src="/static/js/jquery-3.1.1.min.js"></script>-->
<!--<script type="text/javascript" src="/static/js/jquery-1.8.2.min.js"></script>-->
<!--<script type="text/javascript" src="/static/js/fishBone.js"></script>-->
<!--<script type="text/javascript" src="/static/js/jquery.SuperSlide.2.1.1.js"></script>-->
<script src="/static/js/echarts-2/build/dist/echarts.js"></script>
<script src="/static/js/theme_result-1.js"></script>
<script src="/static/js/theme_result-2.js"></script>

{% endblock %}

